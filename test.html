<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Price Calculator</title>
        <!-- link font resources -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">
	<script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	</head>
    <div class="map-container" style="height: 775px;">	
		<style>
			.cologne-map {
				display: flex;
				position: absolute;
			}
			.cologne-map img {
				pointer-events: none;
				position: top;
				width: 1000px;
				max-width: 100%;
			}
			.cologne-map svg {
				position: absolute;
			}
			.price-calculator-table {
				font-family: "Manrope", sans-serif;
				background-color: rgb(238,236,239);
			        font-size: min(4vw, 16px);
			        color: white;
				border-collapse: collapse;
				table-layout: fixed;
				width: 1000px;
				max-width: 100%;
			}
			td, th {
				border: 3px solid rgb(238,236,239);
				border-radius:10px;
				text-align: left;
				padding: 10px;
				height: 25px;
			}
			td:nth-child(1), td:nth-child(2), td:nth-child(3){
				background-color: rgba(52, 54, 103, 0.5);
			}
			td:nth-child(1), td:nth-child(2){
				color: black;
			}
			td:nth-child(3){
				font-weight: bold;
				font-style: italic;
			}
			th:nth-child(1), th:nth-child(2), th:nth-child(3) {
				background-color: rgba(52, 54, 103, 0.5);
			}
		</style>
        <table class="price-calculator-table">
            <tr>
                <th><i>Absender</i></th>
                <th><i>Empf√§nger</i></th>
                <th><i>Preis</i></th>
            </tr>
            <tr>
                <td id="table-origin"></td>
                <td id="table-destination"></td>
                <td id="table-price"></td>
            </tr>
        </table>
        <var id="highlightedArea"></var>
        <var id="originArea"></var>
        <var id="destinationArea"></var>
        <div class="cologne-map">
            <svg viewBox="0 0 1000 733">
                <polygon opacity="0" points="366,422 369,400 374,381 381,366 389,352 397,340 408,328 425,313 478,359 464,372 458,379 451,391 446,405 443,421" class="Ehrenfeld"/>
                <polygon opacity="0" points="590,352 609,363 620,373 632,387 639,400 643,414 645,430 643,449 638,463 630,476 621,487 609,497 594,506 576,513 587,357" class="Deutz"/>
                <polygon opacity="0" points="528,188 529,88 555,90 579,95 602,101 626,109 645,118 666,129 643,213 622,204 599,197 576,192 544,188" class="merkenich"/>
            </svg>
            <img src="https://alejandrofsevilla.github.io/bike-syndikat/resources/cologne-map.jpg" alt="Cologne Map">
        </div>
		<script>
			const pricesUrl = "https://alejandrofsevilla.github.io/bike-syndikat/resources/prices.csv";
		    const pricesMap = new Map();
			const areaNames = ["Ehrenfeld", "Deutz", "None"];	
			const originArea = document.getElementById('originArea');
			const destinationArea = document.getElementById('destinationArea');
			const highlightedArea = document.getElementById('highlightedArea');
			const originColor = "rgba(255, 233, 127, 0.5)";
			const destinationColor = "rgba(255, 127, 127, 0.5)";
			const highlightColor = "rgba(52, 54, 103, 0.5)";
			originArea.value = "None";
			destinationArea.value = "None";
			highlightedArea.value = "None";
			/*load prices table: */
			$.get(pricesUrl, (data) => {
				rows = data.split('\n');
				columnKeys = rows[0].split(',').slice(1);
				rows.slice(1).forEach((row, rowNum) => {
					items = row.split(',');
					rowName = items[0];
					items.slice(1).forEach((item, colNum, items) => {
						key = rowName.trim() +"::"+ columnKeys[colNum].trim();
						invertedKey = columnKeys[colNum].trim() +"::"+ rowName.trim();
					    if(!pricesMap.has(key)) {
							pricesMap.set(key, item.trim());
							pricesMap.set(invertedKey, item.trim());
						};
					});
				});
			});
			/*set mouse events: */
			areaNames.forEach((areaName) => {
				var area = document.querySelector('.' + areaName);
				if (area == null) {
					return;
				}
				area.addEventListener('mouseenter', () => {
					/*highlight area: */
					if (originArea.value == areaName || destinationArea.value == areaName) {
						return;
					}
					area.style.fill = highlightColor;
					area.style.opacity = 1.0;
					highlightedArea.value = areaName;		
				});
				area.addEventListener('mouseleave', () => {
					/*unhighlight area: */
					if (originArea.value == areaName || destinationArea.value == areaName) {
						return;
					}
					highlightedArea.value = "None";
					area.style.opacity = 0.0;
				});
				area.addEventListener('click', () => {
					if (originArea.value != "None" && destinationArea.value != "None") {
						/*unset origin and destination: */
						document.querySelector('.' + originArea.value).style.opacity = 0.0;
						document.querySelector('.' + destinationArea.value).style.opacity = 0.0;
						originArea.value = "None";
						destinationArea.value = "None";
						document.getElementById("table-origin").innerHTML = "";
						document.getElementById("table-destination").innerHTML = "";
						document.getElementById("table-price").innerHTML = "";	
						document.getElementById("table-destination").style.backgroundColor = "";
						document.getElementById("table-origin").style.backgroundColor = "";
						return;
					}
					else if (originArea.value == areaName) {
						/*unset origin: */
						area.style.opacity = 0.0;
						originArea.value = "None";
						document.getElementById("table-origin").innerHTML = "";
						document.getElementById("table-origin").style.backgroundColor = "";
						document.getElementById("table-destination").innerHTML = "";
						document.getElementById("table-destination").style.backgroundColor = "";
						document.getElementById("table-price").innerHTML = "";
						return;
					} else if (originArea.value == "None") {
						/*set origin: */
						area.style.fill = originColor;
						area.style.opacity = 1.0;
						originArea.value = areaName;
						document.getElementById("table-origin").innerHTML = areaName;
						document.getElementById("table-origin").style.backgroundColor = originColor;
						document.getElementById("table-destination").innerHTML = areaName;
						document.getElementById("table-destination").style.backgroundColor = originColor;
						document.getElementById("table-price").innerHTML 
							= pricesMap.get(areaName + "::" + areaName);		
						return;
					}
					/*set destination: */
					area.style.fill = destinationColor;
					area.style.opacity = 1.0;
					destinationArea.value = areaName;
					document.getElementById("table-destination").innerHTML = areaName;
					document.getElementById("table-destination").style.backgroundColor = destinationColor;
					document.getElementById("table-price").innerHTML
						= pricesMap.get(originArea.value + "::" + areaName);
				});
			});
		</script>
    </div>
</html>
